<script>
  import locales from "@blitzkit/i18n/locales.json";
  import { getBestLocale } from "../core/i18n/getBestLocale";

  const isAPI = window.location.pathname.startsWith("/api");
  const isI18nPath = locales.supported.some(({ locale }) =>
    window.location.pathname.startsWith(`/${locale}/`),
  );
  const bestLocale = getBestLocale();
  const currentPath = locales.supported.find(({ locale }) =>
    window.location.pathname.startsWith(`/${locale}/`),
  );

  if (
    !isAPI && // not an api, duh!
    localStorage.getItem("preferred-locale") !== null && // no preference, so probably google's crawler
    ((bestLocale === locales.default && currentPath !== undefined) ||
    (bestLocale !== currentPath))
  ) {
    window.location.pathname = isI18nPath
      ? window.location.pathname.replace(
          `/${currentPath?.locale}`,
          bestLocale === locales.default ? "" : `/${bestLocale}`,
        )
      : `${bestLocale}${window.location.pathname}`;
  }
</script>
