---
import { pwaInfo } from "virtual:pwa-info";
---

<script>
  import { pwaInstallHandler } from "pwa-install-handler";
  import { registerSW } from "virtual:pwa-register";

  registerSW({
    immediate: true,

    onRegisterError: console.error,

    onRegisteredSW() {
      console.log("PWA registered service worker");
    },

    onOfflineReady() {
      console.log("PWA offline ready");
    },
  });

  pwaInstallHandler.addListener((canInstall) => {
    document.documentElement.classList.remove(
      canInstall ? "pwa-disabled" : "pwa-enabled"
    );
    document.documentElement.classList.add(
      canInstall ? "pwa-enabled" : "pwa-disabled"
    );
  });
</script>

{pwaInfo && <Fragment set:html={pwaInfo.webManifest.linkTag} />}
