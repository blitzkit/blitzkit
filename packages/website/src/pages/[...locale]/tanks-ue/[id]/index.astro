---
import type {
  CatalogItemsComponent,
  TankCatalogComponent,
} from '@blitzkit/closed/src/unreal/protos';
import type { GetStaticPaths } from 'astro';
import { metadata } from '../../../../core/blitz/metadata';
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { getStaticPaths as parentGetStaticPaths } from '../index.astro';
import { Page } from './_index';

export const getStaticPaths = (async () => {
  const tanks = await metadata
    .get('CatalogItemsGroupEntity.all_tanks')
    .then((components) =>
      components.get<CatalogItemsComponent>('catalogItemsGroupComponent'),
    );
  const parentPaths = parentGetStaticPaths();

  return tanks.catalog_items
    .map((item) => {
      const id = item.replace('TankEntity.', '');

      return parentPaths.map((parent) => ({
        params: { ...parent.params, id },
        props: { item },
      }));
    })
    .flat();
}) satisfies GetStaticPaths;

const { id, locale } = Astro.params;
const { item } = Astro.props;
const tank = await metadata
  .get(item)
  .then((components) =>
    components.get<TankCatalogComponent>('tankCatalogComponent'),
  );
---

<BaseLayout>
  <Page client:load {locale} {tank} />
</BaseLayout>
